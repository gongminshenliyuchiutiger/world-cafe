
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>公民咖啡館輪桌計時系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #f9f7f7 0%, #e3f2fd 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .content {
            flex: 1;
        }
        
        .timer-circle {
            position: relative;
            width: 280px;
            height: 280px;
        }
        
        .timer-circle svg {
            transform: rotate(-90deg);
        }
        
        .timer-circle circle {
            transition: stroke-dashoffset 1s linear;
        }
        
        .notification {
            animation: slideIn 0.5s ease-out forwards;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
        }
        
        .btn-outline {
            transition: all 0.3s ease;
        }
        
        .btn-outline:hover {
            background-color: rgba(59, 130, 246, 0.1);
        }
        
        .table-card {
            transition: all 0.3s ease;
        }
        
        .table-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .sound-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .sound-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .sound-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .sound-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .sound-slider {
            background-color: #3b82f6;
        }
        
        input:checked + .sound-slider:before {
            transform: translateX(26px);
        }
        
        footer {
            margin-top: auto;
        }
    </style>
</head>
<body>
    <div class="content container mx-auto px-4 py-8 max-w-5xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-blue-800 mb-2">公民咖啡館輪桌計時系統</h1>
            <p class="text-gray-600 text-lg">輕鬆管理討論時間，提升會議效率</p>
        </header>

        <div id="notification" class="hidden fixed top-4 left-1/2 transform -translate-x-1/2 bg-blue-600 text-white px-6 py-3 rounded-lg shadow-lg notification z-50">
            <p class="font-medium text-lg"></p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- 左側：設定面板 -->
            <div class="bg-white rounded-xl shadow-lg p-6 order-2 lg:order-1">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">時間設定</h2>
                
                <div class="mb-6">
                    <label class="block text-gray-700 mb-2 font-medium">每輪討論時間</label>
                    <div class="flex items-center">
                        <input type="number" id="discussionMinutes" class="w-20 px-3 py-2 border border-gray-300 rounded-lg mr-2 focus:outline-none focus:ring-2 focus:ring-blue-500" value="20" min="1">
                        <span class="text-gray-600">分鐘</span>
                    </div>
                </div>
                
                <div class="mb-6">
                    <label class="block text-gray-700 mb-2 font-medium">輪桌提醒時間</label>
                    <div class="flex items-center">
                        <input type="number" id="reminderMinutes" class="w-20 px-3 py-2 border border-gray-300 rounded-lg mr-2 focus:outline-none focus:ring-2 focus:ring-blue-500" value="2" min="1">
                        <span class="text-gray-600">分鐘前提醒</span>
                    </div>
                </div>
                
                <div class="mb-6">
                    <label class="block text-gray-700 mb-2 font-medium">總輪桌次數</label>
                    <div class="flex items-center">
                        <input type="number" id="totalRounds" class="w-20 px-3 py-2 border border-gray-300 rounded-lg mr-2 focus:outline-none focus:ring-2 focus:ring-blue-500" value="3" min="1">
                        <span class="text-gray-600">輪</span>
                    </div>
                </div>
                
                <div class="mb-6">
                    <label class="block text-gray-700 mb-2 font-medium">輪桌間休息時間</label>
                    <div class="flex items-center">
                        <input type="number" id="breakMinutes" class="w-20 px-3 py-2 border border-gray-300 rounded-lg mr-2 focus:outline-none focus:ring-2 focus:ring-blue-500" value="5" min="0">
                        <span class="text-gray-600">分鐘</span>
                    </div>
                </div>
                
                <div class="mb-6">
                    <label class="flex items-center justify-between text-gray-700 font-medium">
                        <span>提醒鈴聲</span>
                        <label class="sound-switch">
                            <input type="checkbox" id="soundToggle" checked>
                            <span class="sound-slider"></span>
                        </label>
                    </label>
                    <div class="mt-3">
                        <label class="block text-gray-600 text-sm mb-1">鈴聲類型</label>
                        <select id="soundType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="bell">溫和鈴聲</option>
                            <option value="chime">清脆鈴聲</option>
                            <option value="alert">警示音</option>
                        </select>
                    </div>
                    <button id="testSound" class="mt-2 w-full bg-gray-100 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-200 transition">
                        測試鈴聲
                    </button>
                </div>
                
                <button id="applySettings" class="w-full btn-primary text-white py-3 px-6 rounded-lg font-medium">
                    套用設定
                </button>
            </div>
            
            <!-- 中間：計時器 -->
            <div class="bg-white rounded-xl shadow-lg p-6 flex flex-col items-center order-1 lg:order-2">
                <div class="mb-4">
                    <h2 class="text-2xl font-bold text-center text-gray-800">
                        <span id="currentRound">第 1 輪</span>
                        <span id="breakIndicator" class="hidden text-orange-500">（休息時間）</span>
                    </h2>
                    <p id="statusText" class="text-center text-gray-600 mt-1">討論進行中</p>
                </div>
                
                <div class="timer-circle flex items-center justify-center mb-6">
                    <svg width="280" height="280">
                        <circle cx="140" cy="140" r="120" fill="none" stroke="#e5e7eb" stroke-width="16"></circle>
                        <circle id="timerCircle" cx="140" cy="140" r="120" fill="none" stroke="#3b82f6" stroke-width="16" stroke-dasharray="754" stroke-dashoffset="0"></circle>
                    </svg>
                    <div class="absolute text-center">
                        <div id="timeDisplay" class="text-5xl font-bold text-gray-800">20:00</div>
                        <div id="timeDescription" class="text-gray-500 mt-2">剩餘時間</div>
                    </div>
                </div>
                
                <div class="flex space-x-4 w-full">
                    <button id="startBtn" class="flex-1 btn-primary text-white py-3 px-6 rounded-lg font-medium">
                        開始
                    </button>
                    <button id="pauseBtn" class="flex-1 btn-outline border border-blue-500 text-blue-500 py-3 px-6 rounded-lg font-medium" disabled>
                        暫停
                    </button>
                    <button id="resetBtn" class="flex-1 btn-outline border border-gray-400 text-gray-500 py-3 px-6 rounded-lg font-medium" disabled>
                        重置
                    </button>
                </div>
                
                <button id="skipBtn" class="mt-4 w-full btn-secondary text-white py-3 px-6 rounded-lg font-medium" disabled>
                    跳至下一輪
                </button>
            </div>
            
            <!-- 右側：輪桌狀態 -->
            <div class="bg-white rounded-xl shadow-lg p-6 order-3">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">輪桌進度</h2>
                
                <div id="roundsContainer" class="space-y-4">
                    <!-- 輪桌卡片會在這裡動態生成 -->
                </div>
            </div>
        </div>
    </div>

    <footer class="py-4 bg-gray-800 text-white text-center mt-8">
        <p>Copyright © Liyuchiutiger Gongminshen</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 獲取DOM元素
            const timeDisplay = document.getElementById('timeDisplay');
            const timerCircle = document.getElementById('timerCircle');
            const startBtn = document.getElementById('startBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            const resetBtn = document.getElementById('resetBtn');
            const skipBtn = document.getElementById('skipBtn');
            const applySettings = document.getElementById('applySettings');
            const currentRound = document.getElementById('currentRound');
            const breakIndicator = document.getElementById('breakIndicator');
            const statusText = document.getElementById('statusText');
            const roundsContainer = document.getElementById('roundsContainer');
            const notification = document.getElementById('notification');
            const soundToggle = document.getElementById('soundToggle');
            const soundType = document.getElementById('soundType');
            const testSound = document.getElementById('testSound');
            
            // 計時器狀態
            let timer = null;
            let isRunning = false;
            let isPaused = false;
            let isBreak = false;
            let currentRoundNumber = 1;
            let timeRemaining = 0;
            let totalTime = 0;
            let reminderTime = 0;
            let reminderShown = false;
            
            // 設定參數
            let discussionMinutes = 20;
            let reminderMinutes = 2;
            let totalRounds = 3;
            let breakMinutes = 5;
            
            // Web Audio API 設定
            let audioContext = null;
            
            // 初始化 Web Audio API
            function initAudio() {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.error('Web Audio API is not supported in this browser');
                    soundToggle.checked = false;
                    soundToggle.disabled = true;
                    testSound.disabled = true;
                }
            }
            
            // 播放提醒鈴聲
            function playSound(type = 'bell') {
                if (!audioContext || !soundToggle.checked) return;
                
                // 確保 AudioContext 處於運行狀態
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                
                // 創建音頻節點
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                // 連接節點
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // 設置音量
                gainNode.gain.value = 0.3;
                
                // 根據類型設置不同的音效
                switch (type) {
                    case 'bell':
                        // 溫和鈴聲
                        oscillator.type = 'sine';
                        oscillator.frequency.setValueAtTime(880, audioContext.currentTime);
                        
                        // 音量淡入淡出
                        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                        gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.1);
                        gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 1.5);
                        
                        // 開始播放並在1.5秒後停止
                        oscillator.start();
                        oscillator.stop(audioContext.currentTime + 1.5);
                        
                        // 0.5秒後播放第二個音
                        setTimeout(() => {
                            const osc2 = audioContext.createOscillator();
                            const gain2 = audioContext.createGain();
                            
                            osc2.connect(gain2);
                            gain2.connect(audioContext.destination);
                            
                            osc2.type = 'sine';
                            osc2.frequency.setValueAtTime(1046.5, audioContext.currentTime);
                            
                            gain2.gain.setValueAtTime(0, audioContext.currentTime);
                            gain2.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.1);
                            gain2.gain.linearRampToValueAtTime(0, audioContext.currentTime + 1.5);
                            
                            osc2.start();
                            osc2.stop(audioContext.currentTime + 1.5);
                        }, 500);
                        break;
                        
                    case 'chime':
                        // 清脆鈴聲
                        oscillator.type = 'triangle';
                        oscillator.frequency.setValueAtTime(1318.51, audioContext.currentTime); // E6
                        
                        // 音量淡入淡出
                        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                        gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.05);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1.0);
                        
                        // 開始播放並在1秒後停止
                        oscillator.start();
                        oscillator.stop(audioContext.currentTime + 1.0);
                        
                        // 連續播放三個音
                        setTimeout(() => {
                            const osc2 = audioContext.createOscillator();
                            const gain2 = audioContext.createGain();
                            
                            osc2.connect(gain2);
                            gain2.connect(audioContext.destination);
                            
                            osc2.type = 'triangle';
                            osc2.frequency.setValueAtTime(1567.98, audioContext.currentTime); // G6
                            
                            gain2.gain.setValueAtTime(0, audioContext.currentTime);
                            gain2.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.05);
                            gain2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1.0);
                            
                            osc2.start();
                            osc2.stop(audioContext.currentTime + 1.0);
                        }, 200);
                        
                        setTimeout(() => {
                            const osc3 = audioContext.createOscillator();
                            const gain3 = audioContext.createGain();
                            
                            osc3.connect(gain3);
                            gain3.connect(audioContext.destination);
                            
                            osc3.type = 'triangle';
                            osc3.frequency.setValueAtTime(2093.00, audioContext.currentTime); // C7
                            
                            gain3.gain.setValueAtTime(0, audioContext.currentTime);
                            gain3.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.05);
                            gain3.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1.0);
                            
                            osc3.start();
                            osc3.stop(audioContext.currentTime + 1.0);
                        }, 400);
                        break;
                        
                    case 'alert':
                        // 警示音
                        oscillator.type = 'sawtooth';
                        oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                        
                        // 音量淡入淡出
                        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                        gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.1);
                        
                        // 頻率變化
                        oscillator.frequency.linearRampToValueAtTime(880, audioContext.currentTime + 0.2);
                        oscillator.frequency.linearRampToValueAtTime(440, audioContext.currentTime + 0.4);
                        oscillator.frequency.linearRampToValueAtTime(880, audioContext.currentTime + 0.6);
                        
                        gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.8);
                        
                        // 開始播放並在0.8秒後停止
                        oscillator.start();
                        oscillator.stop(audioContext.currentTime + 0.8);
                        
                        // 重複播放
                        setTimeout(() => {
                            const osc2 = audioContext.createOscillator();
                            const gain2 = audioContext.createGain();
                            
                            osc2.connect(gain2);
                            gain2.connect(audioContext.destination);
                            
                            osc2.type = 'sawtooth';
                            osc2.frequency.setValueAtTime(440, audioContext.currentTime);
                            
                            gain2.gain.setValueAtTime(0, audioContext.currentTime);
                            gain2.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.1);
                            
                            osc2.frequency.linearRampToValueAtTime(880, audioContext.currentTime + 0.2);
                            osc2.frequency.linearRampToValueAtTime(440, audioContext.currentTime + 0.4);
                            osc2.frequency.linearRampToValueAtTime(880, audioContext.currentTime + 0.6);
                            
                            gain2.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.8);
                            
                            osc2.start();
                            osc2.stop(audioContext.currentTime + 0.8);
                        }, 1000);
                        break;
                }
            }
            
            // 初始化輪桌狀態卡片
            function initializeRoundCards() {
                roundsContainer.innerHTML = '';
                
                for (let i = 1; i <= totalRounds; i++) {
                    const card = document.createElement('div');
                    card.id = `round-${i}`;
                    card.className = `table-card p-4 border rounded-lg ${i === 1 ? 'bg-blue-50 border-blue-300' : 'bg-gray-50 border-gray-200'}`;
                    
                    card.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="font-medium text-lg">第 ${i} 輪討論</h3>
                                <p class="text-gray-500 text-sm">${discussionMinutes} 分鐘</p>
                            </div>
                            <div class="w-3 h-3 rounded-full ${i === 1 ? 'bg-blue-500' : 'bg-gray-300'}"></div>
                        </div>
                    `;
                    
                    roundsContainer.appendChild(card);
                    
                    if (i < totalRounds && breakMinutes > 0) {
                        const breakCard = document.createElement('div');
                        breakCard.id = `break-${i}`;
                        breakCard.className = 'table-card p-4 border rounded-lg bg-gray-50 border-gray-200';
                        
                        breakCard.innerHTML = `
                            <div class="flex justify-between items-center">
                                <div>
                                    <h3 class="font-medium text-lg text-orange-500">休息時間</h3>
                                    <p class="text-gray-500 text-sm">${breakMinutes} 分鐘</p>
                                </div>
                                <div class="w-3 h-3 rounded-full bg-gray-300"></div>
                            </div>
                        `;
                        
                        roundsContainer.appendChild(breakCard);
                    }
                }
            }
            
            // 更新輪桌狀態卡片
            function updateRoundCards() {
                // 重置所有卡片
                document.querySelectorAll('.table-card').forEach(card => {
                    card.classList.remove('bg-blue-50', 'border-blue-300', 'bg-orange-50', 'border-orange-300');
                    card.classList.add('bg-gray-50', 'border-gray-200');
                    
                    const indicator = card.querySelector('.rounded-full');
                    indicator.classList.remove('bg-blue-500', 'bg-orange-500');
                    indicator.classList.add('bg-gray-300');
                });
                
                // 標記當前輪桌或休息
                const currentCardId = isBreak ? `break-${currentRoundNumber}` : `round-${currentRoundNumber}`;
                const currentCard = document.getElementById(currentCardId);
                
                if (currentCard) {
                    if (isBreak) {
                        currentCard.classList.remove('bg-gray-50', 'border-gray-200');
                        currentCard.classList.add('bg-orange-50', 'border-orange-300');
                        
                        const indicator = currentCard.querySelector('.rounded-full');
                        indicator.classList.remove('bg-gray-300');
                        indicator.classList.add('bg-orange-500');
                    } else {
                        currentCard.classList.remove('bg-gray-50', 'border-gray-200');
                        currentCard.classList.add('bg-blue-50', 'border-blue-300');
                        
                        const indicator = currentCard.querySelector('.rounded-full');
                        indicator.classList.remove('bg-gray-300');
                        indicator.classList.add('bg-blue-500');
                    }
                }
                
                // 標記已完成的輪桌
                for (let i = 1; i < currentRoundNumber; i++) {
                    const completedRound = document.getElementById(`round-${i}`);
                    if (completedRound) {
                        const indicator = completedRound.querySelector('.rounded-full');
                        indicator.classList.remove('bg-gray-300', 'bg-blue-500');
                        indicator.classList.add('bg-green-500');
                    }
                    
                    const completedBreak = document.getElementById(`break-${i}`);
                    if (completedBreak) {
                        const indicator = completedBreak.querySelector('.rounded-full');
                        indicator.classList.remove('bg-gray-300', 'bg-orange-500');
                        indicator.classList.add('bg-green-500');
                    }
                }
            }
            
            // 格式化時間
            function formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            
            // 更新計時器顯示
            function updateTimerDisplay() {
                timeDisplay.textContent = formatTime(timeRemaining);
                
                // 更新圓環進度
                const circumference = 2 * Math.PI * 120;
                const offset = circumference - (timeRemaining / totalTime) * circumference;
                timerCircle.style.strokeDasharray = circumference;
                timerCircle.style.strokeDashoffset = offset;
                
                // 當時間少於20%時，改變顏色
                if (timeRemaining / totalTime < 0.2) {
                    timerCircle.style.stroke = '#ef4444';
                } else {
                    timerCircle.style.stroke = '#3b82f6';
                }
                
                // 更新頁面標題
                document.title = `${formatTime(timeRemaining)} - 公民咖啡館輪桌計時系統`;
            }
            
            // 顯示通知
            function showNotification(message, isWarning = false) {
                const notificationElement = document.getElementById('notification');
                notificationElement.querySelector('p').textContent = message;
                
                if (isWarning) {
                    notificationElement.classList.remove('bg-blue-600');
                    notificationElement.classList.add('bg-orange-500');
                    
                    // 播放提醒鈴聲
                    playSound(soundType.value);
                } else {
                    notificationElement.classList.remove('bg-orange-500');
                    notificationElement.classList.add('bg-blue-600');
                    
                    // 播放提醒鈴聲
                    if (message.includes('開始') || message.includes('結束')) {
                        playSound(soundType.value);
                    }
                }
                
                notificationElement.classList.remove('hidden');
                
                setTimeout(() => {
                    notificationElement.classList.add('hidden');
                }, 5000);
            }
            
            // 開始計時器
            function startTimer() {
                if (isRunning && !isPaused) return;
                
                if (!isPaused) {
                    // 如果不是從暫停恢復，則初始化計時器
                    timeRemaining = isBreak ? breakMinutes * 60 : discussionMinutes * 60;
                    totalTime = timeRemaining;
                    reminderTime = reminderMinutes * 60;
                    reminderShown = false;
                }
                
                isRunning = true;
                isPaused = false;
                
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                resetBtn.disabled = false;
                skipBtn.disabled = false;
                
                updateTimerDisplay();
                
                timer = setInterval(() => {
                    timeRemaining--;
                    
                    // 檢查是否需要顯示提醒
                    if (!isBreak && !reminderShown && timeRemaining <= reminderTime && timeRemaining > 0) {
                        showNotification(`還剩 ${reminderMinutes} 分鐘，請準備輪換桌次`, true);
                        reminderShown = true;
                    }
                    
                    updateTimerDisplay();
                    
                    if (timeRemaining <= 0) {
                        clearInterval(timer);
                        
                        if (isBreak) {
                            // 休息結束，進入下一輪討論
                            isBreak = false;
                            showNotification(`第 ${currentRoundNumber} 輪討論開始！`);
                            breakIndicator.classList.add('hidden');
                            statusText.textContent = '討論進行中';
                        } else if (currentRoundNumber < totalRounds) {
                            // 討論結束，進入休息或下一輪
                            if (breakMinutes > 0) {
                                isBreak = true;
                                showNotification('休息時間開始！');
                                breakIndicator.classList.remove('hidden');
                                statusText.textContent = '休息時間';
                            } else {
                                currentRoundNumber++;
                                showNotification(`第 ${currentRoundNumber} 輪討論開始！`);
                            }
                        } else {
                            // 所有輪桌結束
                            showNotification('所有輪桌討論已結束！');
                            resetTimer(true);
                            return;
                        }
                        
                        // 更新UI
                        if (!isBreak && breakMinutes > 0) {
                            currentRoundNumber++;
                        }
                        
                        currentRound.textContent = `第 ${currentRoundNumber} 輪`;
                        updateRoundCards();
                        
                        // 自動開始下一輪計時
                        startTimer();
                    }
                }, 1000);
            }
            
            // 暫停計時器
            function pauseTimer() {
                if (!isRunning) return;
                
                clearInterval(timer);
                isPaused = true;
                
                startBtn.disabled = false;
                startBtn.textContent = '繼續';
                pauseBtn.disabled = true;
            }
            
            // 重置計時器
            function resetTimer(completed = false) {
                clearInterval(timer);
                isRunning = false;
                isPaused = false;
                
                if (!completed) {
                    currentRoundNumber = 1;
                    isBreak = false;
                    breakIndicator.classList.add('hidden');
                    statusText.textContent = '討論進行中';
                    currentRound.textContent = `第 ${currentRoundNumber} 輪`;
                }
                
                timeRemaining = discussionMinutes * 60;
                totalTime = timeRemaining;
                
                startBtn.disabled = false;
                startBtn.textContent = '開始';
                pauseBtn.disabled = true;
                resetBtn.disabled = true;
                skipBtn.disabled = true;
                
                updateTimerDisplay();
                updateRoundCards();
                
                // 重置頁面標題
                document.title = '公民咖啡館輪桌計時系統';
            }
            
            // 跳至下一輪
            function skipToNextRound() {
                clearInterval(timer);
                
                if (isBreak) {
                    // 如果在休息時間，跳到下一輪討論
                    isBreak = false;
                    breakIndicator.classList.add('hidden');
                    statusText.textContent = '討論進行中';
                } else if (currentRoundNumber < totalRounds) {
                    // 如果在討論時間，且不是最後一輪
                    if (breakMinutes > 0) {
                        isBreak = true;
                        breakIndicator.classList.remove('hidden');
                        statusText.textContent = '休息時間';
                    } else {
                        currentRoundNumber++;
                    }
                } else {
                    // 如果是最後一輪，結束所有討論
                    showNotification('所有輪桌討論已結束！');
                    resetTimer(true);
                    return;
                }
                
                // 更新UI
                if (!isBreak && breakMinutes > 0) {
                    currentRoundNumber++;
                }
                
                if (currentRoundNumber > totalRounds) {
                    showNotification('所有輪桌討論已結束！');
                    resetTimer(true);
                    return;
                }
                
                currentRound.textContent = `第 ${currentRoundNumber} 輪`;
                updateRoundCards();
                
                // 自動開始下一輪計時
                startTimer();
            }
            
            // 套用設定
            function applyNewSettings() {
                discussionMinutes = parseInt(document.getElementById('discussionMinutes').value) || 20;
                reminderMinutes = parseInt(document.getElementById('reminderMinutes').value) || 2;
                totalRounds = parseInt(document.getElementById('totalRounds').value) || 3;
                breakMinutes = parseInt(document.getElementById('breakMinutes').value) || 5;
                
                // 驗證設定
                if (reminderMinutes >= discussionMinutes) {
                    reminderMinutes = discussionMinutes - 1;
                    document.getElementById('reminderMinutes').value = reminderMinutes;
                    showNotification('提醒時間已調整為小於討論時間', true);
                }
                
                // 重置計時器
                resetTimer();
                
                // 重新初始化輪桌卡片
                initializeRoundCards();
                
                showNotification('設定已套用');
            }
            
            // 初始化
            initAudio();
            resetTimer();
            initializeRoundCards();
            
            // 事件監聽
            startBtn.addEventListener('click', startTimer);
            pauseBtn.addEventListener('click', pauseTimer);
            resetBtn.addEventListener('click', resetTimer);
            skipBtn.addEventListener('click', skipToNextRound);
            applySettings.addEventListener('click', applyNewSettings);
            testSound.addEventListener('click', () => playSound(soundType.value));
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'932af438d305075c',t:'MTc0NTA1MDUyNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>